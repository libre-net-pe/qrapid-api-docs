post:
  tags:
    - Dynamic QR Codes
  summary: Create a dynamic QR code
  description: |
    Creates a dynamic QR code and saves it to the authenticated user's library.
    The QR image encodes a QRapid short URL (`go.qrapid.io/<slug>`) that redirects
    to the `destinationUrl`. The destination can be changed at any time via
    `PATCH /dynamic-qr-codes/{id}` without reprinting the QR code.

    If no `slug` is provided, the server generates a random 8-character alphanumeric
    slug. Custom slugs must be unique; a 409 is returned if the slug is already taken.

    **Processing time:** < 500ms p95.
  operationId: createDynamicQrCode
  security:
    - firebase_jwt: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: ../components/schemas/DynamicQrCodeCreateRequest.yaml
        examples:
          auto_slug:
            summary: Auto-generated slug
            value:
              destinationUrl: 'https://example.com/menu'
              label: Restaurant Menu
          custom_slug:
            summary: Custom slug
            value:
              destinationUrl: 'https://example.com/menu'
              slug: my-menu
              label: Restaurant Menu
  responses:
    '201':
      description: Dynamic QR code created successfully.
      content:
        application/json:
          schema:
            $ref: ../components/schemas/DynamicQrCode.yaml
          example:
            id: dqr_abc123xyz
            destinationUrl: 'https://example.com/menu'
            shortUrl: 'https://go.qrapid.io/my-menu'
            slug: my-menu
            label: Restaurant Menu
            status: active
            downloadUrl: 'https://cdn.qrapid.io/dqr/dqr_abc123xyz.png'
            scanCount: 0
            lastScannedAt: null
            expiresAt: null
            createdAt: '2026-02-18T12:00:00Z'
            updatedAt: '2026-02-18T12:00:00Z'
    '400':
      description: Invalid request body (e.g., non-absolute URL, invalid slug format).
      content:
        application/problem+json:
          schema:
            $ref: ../components/schemas/Problem.yaml
          example:
            type: 'https://qrapid.io/errors/invalid-destination-url'
            title: Invalid destination URL
            status: 400
            detail: 'The `destinationUrl` must be a valid absolute URL (http or https).'
    '401':
      description: Missing or invalid Firebase JWT.
      content:
        application/problem+json:
          schema:
            $ref: ../components/schemas/Problem.yaml
          example:
            type: 'https://qrapid.io/errors/unauthorized'
            title: Unauthorized
            status: 401
            detail: A valid Firebase ID token is required.
    '409':
      description: The requested slug is already in use.
      content:
        application/problem+json:
          schema:
            $ref: ../components/schemas/Problem.yaml
          example:
            type: 'https://qrapid.io/errors/slug-conflict'
            title: Slug already taken
            status: 409
            detail: 'The slug "my-menu" is already in use. Choose a different slug or omit it to auto-generate one.'

get:
  tags:
    - Dynamic QR Codes
  summary: List dynamic QR codes
  description: >
    Returns a paginated list of the authenticated user's dynamic QR codes, ordered
    by `createdAt` descending. Use the `status` filter to narrow results.
  operationId: listDynamicQrCodes
  security:
    - firebase_jwt: []
  parameters:
    - name: page
      in: query
      description: Page number to retrieve (1-based).
      schema:
        type: integer
        minimum: 1
        default: 1
      example: 1
    - name: limit
      in: query
      description: Number of items per page.
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      example: 20
    - name: folderId
      in: query
      description: >
        Filter by folder. Pass a folder ID to list only codes in that folder.
        Pass the special value `unfiled` to list codes that are not in any folder.
        Omit to return all codes regardless of folder.
      schema:
        type: string
      example: fol_abc123
    - name: status
      in: query
      description: Filter by lifecycle status. Defaults to returning all codes regardless of status.
      schema:
        type: string
        enum:
          - active
          - expired
          - all
        default: all
      example: active
  responses:
    '200':
      description: Paginated list of dynamic QR codes.
      content:
        application/json:
          schema:
            $ref: ../components/schemas/PaginatedDynamicQrCodes.yaml
    '401':
      description: Missing or invalid Firebase JWT.
      content:
        application/problem+json:
          schema:
            $ref: ../components/schemas/Problem.yaml
          example:
            type: 'https://qrapid.io/errors/unauthorized'
            title: Unauthorized
            status: 401
            detail: A valid Firebase ID token is required.
